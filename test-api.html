<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 2rem;
        }
        
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .test-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        .status.pending {
            background: #ffc107;
            color: #333;
        }
        
        .status.success {
            background: #28a745;
            color: white;
        }
        
        .status.error {
            background: #dc3545;
            color: white;
        }
        
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .test-result pre {
            background: #f1f3f5;
            padding: 0.75rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 0.5rem;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .warning strong {
            color: #856404;
        }
        
        .info {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Configuration API</h1>
        <p class="subtitle">V√©rifiez que vos cl√©s API sont correctement configur√©es</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Important :</strong> Avant de lancer les tests, assurez-vous d'avoir remplac√© les cl√©s API 
            'demo' par vos vraies cl√©s dans le fichier <code>script.js</code> ou <code>config.js</code>
        </div>
        
        <button onclick="runAllTests()" id="testBtn">‚ñ∂Ô∏è Lancer tous les tests</button>
        
        <div style="margin-top: 2rem;">
            <!-- Test OpenWeatherMap -->
            <div class="test-section">
                <div class="test-title">
                    ‚òÄÔ∏è OpenWeatherMap (M√©t√©o)
                    <span class="status pending" id="weather-status">En attente</span>
                </div>
                <div class="info">Teste la r√©cup√©ration de la m√©t√©o √† Dubai</div>
                <div class="test-result" id="weather-result" style="display: none;"></div>
            </div>
            
            <!-- Test CoinGecko -->
            <div class="test-section">
                <div class="test-title">
                    üíé CoinGecko (Crypto)
                    <span class="status pending" id="crypto-status">En attente</span>
                </div>
                <div class="info">Teste la r√©cup√©ration des prix des cryptomonnaies</div>
                <div class="test-result" id="crypto-result" style="display: none;"></div>
            </div>
            
            <!-- Test NewsAPI -->
            <div class="test-section">
                <div class="test-title">
                    üì∞ NewsAPI (Actualit√©s)
                    <span class="status pending" id="news-status">En attente</span>
                </div>
                <div class="info">Teste la r√©cup√©ration des actualit√©s</div>
                <div class="test-result" id="news-result" style="display: none;"></div>
            </div>
            
            <!-- Test Leboncoin Backend -->
            <div class="test-section">
                <div class="test-title">
                    üè† Backend Leboncoin (Optionnel)
                    <span class="status pending" id="backend-status">En attente</span>
                </div>
                <div class="info">Teste la connexion au serveur de scraping (si configur√©)</div>
                <div class="test-result" id="backend-result" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <script>
        // R√©cup√©rer la configuration depuis config.js si disponible
        const API_KEYS = typeof CONFIG !== 'undefined' 
            ? CONFIG.apiKeys 
            : {
                openWeather: 'demo',
                newsApi: 'demo'
            };
        
        async function runAllTests() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Tests en cours...';
            
            await testWeather();
            await testCrypto();
            await testNews();
            await testBackend();
            
            btn.disabled = false;
            btn.textContent = 'üîÑ Relancer les tests';
        }
        
        async function testWeather() {
            const statusEl = document.getElementById('weather-status');
            const resultEl = document.getElementById('weather-result');
            
            statusEl.textContent = '‚è≥ Test en cours...';
            statusEl.className = 'status pending';
            resultEl.style.display = 'none';
            
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=Dubai&units=metric&appid=${API_KEYS.openWeather}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                statusEl.textContent = '‚úÖ Succ√®s';
                statusEl.className = 'status success';
                resultEl.innerHTML = `
                    <strong>‚úÖ API OpenWeatherMap fonctionnelle !</strong><br>
                    Temp√©rature √† Dubai : ${data.main.temp}¬∞C<br>
                    Conditions : ${data.weather[0].description}<br>
                    Humidit√© : ${data.main.humidity}%
                `;
                resultEl.style.display = 'block';
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur';
                statusEl.className = 'status error';
                resultEl.innerHTML = `
                    <strong>‚ùå Erreur API OpenWeatherMap</strong><br>
                    ${error.message}<br><br>
                    <strong>Solutions :</strong><br>
                    1. V√©rifiez que vous avez remplac√© 'demo' par votre vraie cl√© API<br>
                    2. Obtenez une cl√© gratuite sur : <a href="https://openweathermap.org/api" target="_blank">openweathermap.org/api</a><br>
                    3. Attendez quelques minutes apr√®s l'activation de votre cl√©
                `;
                resultEl.style.display = 'block';
            }
        }
        
        async function testCrypto() {
            const statusEl = document.getElementById('crypto-status');
            const resultEl = document.getElementById('crypto-result');
            
            statusEl.textContent = '‚è≥ Test en cours...';
            statusEl.className = 'status pending';
            resultEl.style.display = 'none';
            
            try {
                const response = await fetch(
                    'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true'
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                statusEl.textContent = '‚úÖ Succ√®s';
                statusEl.className = 'status success';
                resultEl.innerHTML = `
                    <strong>‚úÖ API CoinGecko fonctionnelle !</strong><br>
                    Bitcoin : $${data.bitcoin.usd.toLocaleString()} 
                    (${data.bitcoin.usd_24h_change > 0 ? '+' : ''}${data.bitcoin.usd_24h_change.toFixed(2)}%)<br>
                    Ethereum : $${data.ethereum.usd.toLocaleString()} 
                    (${data.ethereum.usd_24h_change > 0 ? '+' : ''}${data.ethereum.usd_24h_change.toFixed(2)}%)<br>
                    <em>Cette API ne n√©cessite aucune cl√© ! üéâ</em>
                `;
                resultEl.style.display = 'block';
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur';
                statusEl.className = 'status error';
                resultEl.innerHTML = `
                    <strong>‚ùå Erreur API CoinGecko</strong><br>
                    ${error.message}<br><br>
                    Cette erreur est inhabituelle car CoinGecko ne n√©cessite pas de cl√© API.
                    V√©rifiez votre connexion internet.
                `;
                resultEl.style.display = 'block';
            }
        }
        
        async function testNews() {
            const statusEl = document.getElementById('news-status');
            const resultEl = document.getElementById('news-result');
            
            statusEl.textContent = '‚è≥ Test en cours...';
            statusEl.className = 'status pending';
            resultEl.style.display = 'none';
            
            try {
                const response = await fetch(
                    `https://newsapi.org/v2/top-headlines?country=fr&apiKey=${API_KEYS.newsApi}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'error') {
                    throw new Error(data.message || 'Erreur API');
                }
                
                statusEl.textContent = '‚úÖ Succ√®s';
                statusEl.className = 'status success';
                resultEl.innerHTML = `
                    <strong>‚úÖ API NewsAPI fonctionnelle !</strong><br>
                    ${data.totalResults} articles trouv√©s<br>
                    Premier article : "${data.articles[0]?.title}"<br>
                    Source : ${data.articles[0]?.source?.name}
                `;
                resultEl.style.display = 'block';
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur';
                statusEl.className = 'status error';
                resultEl.innerHTML = `
                    <strong>‚ùå Erreur API NewsAPI</strong><br>
                    ${error.message}<br><br>
                    <strong>Solutions :</strong><br>
                    1. V√©rifiez que vous avez remplac√© 'demo' par votre vraie cl√© API<br>
                    2. Obtenez une cl√© gratuite sur : <a href="https://newsapi.org/" target="_blank">newsapi.org</a><br>
                    3. V√©rifiez que vous n'avez pas d√©pass√© la limite gratuite (100 requ√™tes/jour)
                `;
                resultEl.style.display = 'block';
            }
        }
        
        async function testBackend() {
            const statusEl = document.getElementById('backend-status');
            const resultEl = document.getElementById('backend-result');
            
            statusEl.textContent = '‚è≥ Test en cours...';
            statusEl.className = 'status pending';
            resultEl.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:3000/health', {
                    signal: AbortSignal.timeout(3000)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                statusEl.textContent = '‚úÖ Connect√©';
                statusEl.className = 'status success';
                resultEl.innerHTML = `
                    <strong>‚úÖ Serveur backend actif !</strong><br>
                    Status : ${data.status}<br>
                    Le scraping Leboncoin est disponible.<br>
                    <a href="http://localhost:3000/api/realestate" target="_blank">
                        Tester l'API Leboncoin ‚Üí
                    </a>
                `;
                resultEl.style.display = 'block';
            } catch (error) {
                statusEl.textContent = '‚ö†Ô∏è Non configur√©';
                statusEl.className = 'status pending';
                resultEl.innerHTML = `
                    <strong>‚ÑπÔ∏è Backend non d√©tect√© (optionnel)</strong><br>
                    Le scraping automatique de Leboncoin n'est pas configur√©.<br>
                    C'est normal si vous n'avez pas install√© le backend Node.js.<br><br>
                    <strong>Pour l'activer :</strong><br>
                    1. Installez Node.js<br>
                    2. Ex√©cutez <code>npm install</code><br>
                    3. Lancez <code>node leboncoin-scraper.js</code><br>
                    4. Relancez ce test
                `;
                resultEl.style.display = 'block';
            }
        }
    </script>
</body>
</html>
